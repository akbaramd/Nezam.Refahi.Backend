---
globs: **/**.Domain/**/*.cs
alwaysApply: false
---
# DDD Domain-Driven Design Rulebook

โ๏ธ **ูุฑ ฺุฒ ุฎุงุฑุฌ ุงุฒ ุงู ููุงูู ุจุงุฏ ุจุฑุฑุณ ู ุจู ุชุตูุจ ุจุฑุณุฏ.**  
โ๏ธ **ุทุฑุงุญ ุฏุงููู ู ูุฏูโุณุงุฒ ุจุงุฏ ุจูโุตูุฑุช ุณุฎุชโฺฏุฑุงูู ุงูุฌุงู ุดูุฏ.**  
โ๏ธ **ูุฏูโุณุงุฒ ุฏุงููู ูุจุงุฏ ุฎูุฏุณุฑุงูู ุงูุฌุงู ุดูุฏุ ุจุงุฏ ุจุง ฺฏูุชโูฺฏู ู ููุงููฺฏ ุชู ุฏุงููู ุณุงุฎุชู ุดูุฏ.**

---

## ๐ ุงุตูู ูพุงู
- **Ubiquitous Language**: ูุงูโฺฏุฐุงุฑโูุง ุจุงุฏ ุงุฒ ุฒุจุงู ูุดุชุฑฺฉ ุฏุงููู ุงุณุชุฎุฑุงุฌ ุดููุฏ.
- **Isolation**: ูุฑุฒุจูุฏ Bounded Contextูุง ุดูุงู ู ูุณุชูู. ุงุฑุฌุงุน ูุณุชูู ุจู ูุฏูโูุง ุฏุงุฎู ุณุงุฑ Contextูุง ููููุน ุงุณุช.
- **Explicitness**: ููุงูู ุฏุงููู ุจุงุฏ ุฏุฑ ูุฏู ุฏุงููู ฺฉูพุณููู ุดููุฏ (Entities/ValueObjects/Aggregates). ููุทู ุฏุงููู ุฏุฑ UI/Infra ูุฑุงุฑ ูฺฏุฑุฏ.
- **Behavior First**: ุทุฑุงุญ ุงุจุชุฏุง ุจุฑ ุงุณุงุณ ุฑูุชุงุฑ ุฏุงูููุ ูู ุฏุชุงุจุณ.
- **Immutability Preference**: ValueObjectูุง ุชุง ุญุฏ ุงูฺฉุงู Immutable ุจุงุดูุฏ.
- **Invariants Inside**: ุชูุงู Invariantูุง ุฏุงุฎู Aggregate Root enforce ุดููุฏ.
- **Transactional Boundary**: ูุฑ ุชุฑุงฺฉูุด ููุท ฺฉ Aggregate Root ุฑุง ุชุบุฑ ุฏูุฏ.
- **Persistence Agnostic**: ูุฏู ุฏุงููู ูุณุชูู ุงุฒ ORM/DB.
- **CQRS**: Query ุงุฒ ReadModel ุฌุฏุง ุจุงุดุฏุ Repository ููุท ุจุฑุง Aggregate Root.
- **Domain Events**: ุชุบุฑุงุช ููู ุจุง DomainEvent ุซุจุช ู ููุชุดุฑ ุดููุฏุ ุจุฑุง ุจุฑููโูุฑุฒ ุงุฒ Outbox ุงุณุชูุงุฏู ุดูุฏ.
- **Idempotency**: ุฏุณุชูุฑุงุช ุญุณุงุณ ู ุฑูุฏุงุฏูุง ุจุงุฏ Idempotent ุทุฑุงุญ ุดููุฏ.
- **Optimistic Concurrency**: ูุณุฎูโฺฏุฐุงุฑ Aggregate ุจุฑุง ูุฏุฑุช ุชุฏุงุฎู.

---

## โ ฺฺฉโูุณุช ุชุตููโฺฏุฑ Entity vs ValueObject
### ุณูุงูโูุง
1. **HasIdentityOverTime?** ุขุง ููุช ูพุงุฏุงุฑ ูุณุชูู ุงุฒ ุตูุงุช ุฏุงุฑุฏุ
2. **LifecycleIndependent?** ฺุฑุฎูโุนูุฑ ูุณุชูู ูุงุฒ ุงุณุชุ
3. **MustBeMutableInsideAggregate?** ุขุง ูุงุฒ ุจู ุชุบุฑ ุญุงูุช ุฏุงุฎู ุฏุงุฑุฏุ
4. **EqualityByIdentityOrByValues?** ุจุฑุงุจุฑ ุจุฑ ุงุณุงุณ ID ุง ููุงุฏุฑุ
5. **CanBeSharedAcrossAggregatesSafely?** ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ ุจโุฎุทุฑ ุจู Aggregateูุงุ
6. **ReplaceNotUpdateSemantics?** ุขุง ููุทูโุชุฑ ุงุณุช ุฌุงฺฏุฒู ุดูุฏ ุชุง ุชุบุฑุ

### ููุงูู
- ุงฺฏุฑ `HasIdentityOverTime=true` ุง `LifecycleIndependent=true` โ **Entity**.
- ุงฺฏุฑ ุจุฑุงุจุฑ ุจุฑ ุงุณุงุณ ููุงุฏุฑ ู `ReplaceNotUpdateSemantics=true` ู ูุงุฒ ุจู ุชุบุฑ ุญุงูุช ูุณุช โ **ValueObject**.
- ุงฺฏุฑ ูุงุฒ ุจู ุฑุฏุงุจ ุง ุงุฑุฌุงุน ุฎุงุฑุฌ ุฏุงุฑุฏ โ **Entity**.
- ุงฺฏุฑ ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ ุจุฏูู ูุงูฺฉุช ูุณุชูู ุฎุทุฑูุงฺฉ ุงุณุช โ **ValueObject** ุฏุงุฎู Aggregate (ูู ุดุก ูุดุชุฑฺฉ).

### ุถุฏุงูฺฏููุง
- ValueObject ุจุง Setter ุนููู.
- Entity ุจุฏูู ุฑูุชุงุฑ ุฏุงููู (Anemic Domain Model).

---

## ๐ ููุงูู Aggregate Root
- Aggregate Root ุชููุง ููุทู ูุฑูุฏ ุชุบุฑุงุช ุงุณุช.
- ุชูุงู Invariantูุง ุฏุงููู ุจุงุฏ ุฏุฑ Aggregate Root enforce ุดููุฏ.
- Aggregate Root ูุจุงุฏ ูุณุชููุงู Aggregate ุฏฺฏุฑ ุฑุง ูุฏุฑุช ฺฉูุฏุ ุงุฑุชุจุงุท ุบุฑูุณุชูู ุงูุฌุงู ุดูุฏ.
- ุงูุฏุงุฒู Aggregate ุฏุฑ ุญุฏ ยซูุฑุฒ ุณุงุฒฺฏุงุฑ ุชุฑุงฺฉูุดยป ูฺฏู ุฏุงุดุชู ุดูุฏ.

---

## ๐งฉ ุงูุฒุงูุงุช ุฑูุชุงุฑ Entity
- Entity ุจุงุฏ **ุฑูุชุงุฑ ุบู** ู **ููุงุดฺฏุฑ ููุงูู ู ูุงูุนุช ุฏุงููู** ุจุงุดุฏุ ููุท ูุฌููุนูโุง ุงุฒ Propertyูุง ู Getter/Setter ูุณุช.
- ุชูุงู ุชุบุฑุงุช ูุนูโุฏุงุฑ ุญุงูุช ุจุงุฏ ุงุฒ ุทุฑู **ูุชุฏูุง ุฏุงููู ุจุง ูุงูโฺฏุฐุงุฑ ูุจุชู ุจุฑ ุฒุจุงู ูุดุชุฑฺฉ** ุงูุฌุงู ุดูุฏ.
- Entity ูุจุงุฏ ููุทู ุงุนุชุจุงุฑุณูุฌ ุฑุง ุจู ูุงู Application/Infra ูุงฺฏุฐุงุฑ ฺฉูุฏุ ุงุนุชุจุงุฑุณูุฌโูุง ุฏุงููู ุฏุงุฎู ุฎูุฏ Entity/Aggregate ุงูุฌุงู ูโุดูุฏ.
- ุฑูุฏุงุฏูุง ุฏุงููู ูุฑุชุจุท ุจุง ุชุบุฑุงุช ูุนูุงุฏุงุฑ ุฏุฑ ููุงู ููุทู ุชุบุฑ **ุงูุชุดุงุฑ** ูโุงุจูุฏ.

---

## ๐ ุงุฑุชุจุงุท ุจู ุฏู Aggregate Root
- **ูุงููู ุณุฎุช**: ุจุฑุง ููุงููฺฏ ุง ุชุนุงูู ุจู ุฏู Aggregate Root **ุญุชูุงู ุจุงุฏ Domain Service** ุชุนุฑู ุดูุฏ. ุงุฑุชุจุงุท ูุณุชูู EntityโEntity ุฏุฑ Aggregateูุง ูุชูุงูุช ููููุน ุงุณุช.
- Domain Service:
  - ุชููุง **ููุงููฺฏโฺฉููุฏู ุฑูุชุงุฑ ฺูุฏ Aggregate** ุงุณุชุ ูุงูฺฉ ูุงูููโูุง ุฏุฑูู ูุฑ Aggregate ูุณุช.
  - ุจูโุฌุง ูฺฏูุฏุงุฑ ูุฑุงุฌุน ูุณุชูู ุจู Aggregateูุง ุฏฺฏุฑุ ุจุง **ุดูุงุณูโูุง (IDูุง)** ู **Repositoryูุง ุฌุฏุงฺฏุงูู** ฺฉุงุฑ ูโฺฉูุฏ.
  - ุงุฒ **Domain Events/Integration Events** ุจุฑุง decouple ฺฉุฑุฏู ุชุนุงููุงุช ุงุณุชูุงุฏู ูโฺฉูุฏ.
- **Cross-Aggregate Invariants** ููููุนุ ุชููุง ููุงููฺฏ ูุงุจู ูุจูู ุงุณุช ูู ุชุถูู ุณุงุฒฺฏุงุฑ ุขู ุจู Aggregateูุง.

---

## ๐ ููุงูู Repository
- **ูุงููู ุณุฎุช (ุบุฑูุงุจู ุชุฎุท)**: **ุจู ูฺ ูุฌู** ุจุฑุง Entityูุง ุฏุงุฎู Repository ุณุงุฎุชู ูุดูุฏุ **Repository ููุท ู ููุท ุจุฑุง Aggregate Root ุชุนุฑู ูโุดูุฏ**.
- Interface Repository ุฏุฑ **Domain** ู ูพุงุฏูโุณุงุฒ ุฏุฑ **Infrastructure** ูุฑุงุฑ ูโฺฏุฑุฏ.
- ูุฑ Repository ุตุฑูุงู ูุณุฆูู **ุจุงุฑฺฏุฐุงุฑ/ุฐุฎุฑู ฺฉ ููุน Aggregate Root** ุงุณุช ู ูุฑุฒ ุชุฑุงฺฉูุด ุฑุง ุฑุนุงุช ูโฺฉูุฏ.
- Queryูุง ุฎูุงูุด ูพฺุฏู ุจู **ReadModel/Query Stack** ููุชูู ุดููุฏุ Repository ุฏุงููู ุจุฑุง Mutation ุงุณุช ูู ฺฏุฒุงุฑุดโฺฏุฑ.
- ุนููุงุช ุจุงุฏ Unit of Work-aware ุจุงุดูุฏ ู ุงุฒ **Optimistic Concurrency** ูพุดุชุจุงู ฺฉููุฏ.

---

## โก Domain Events
- ุฑูุฏุงุฏูุง Immutable ู ุจุฑ ุงุณุงุณ Ubiquitous Language ูุงูโฺฏุฐุงุฑ ุดููุฏ.
- ูุฑ ุชุบุฑ ููู ุฏุงููู ุจุงุฏ ุฑูุฏุงุฏ ุชููุฏ ฺฉูุฏุ Aggregate ููุจุน ุญููุช ุฑูุฏุงุฏ ุงุณุช.
- ุจุฑุง ุงุฑุชุจุงุท ุจู Contextูุง ุงุฒ **Integration Event** ุงุณุชูุงุฏู ุดูุฏุ ุงูุชุดุงุฑ ูุทูุฆู ุงุฒ ุทุฑู **Transactional Outbox**.

---

## ๐ฆ Services
- **Domain Service**: ููุท ููุช ุงุณุชูุงุฏู ุดูุฏ ฺฉู ฺฉ ูุงููู/ุฑูุชุงุฑ ุฏุงููู ุจู ฺูุฏ Entity/ValueObject ุง ฺูุฏ Aggregate ูุฑุจูุท ุงุณุช. ูุงูุฏ State ูพุงุฏุงุฑ ุงุณุช.
- **Application Service**: ููุงููฺฏโฺฉููุฏู Use Caseูุง ู ุชุฑุงฺฉูุดุ ูุงูุฏ ููุทู ุฏุงููู. ฺฉูุชุฑู ุฏุณุชุฑุณุ Validation ุณุทุญ ฺฉุงุฑุจุฑุฏ ู ุขุฏุงูพุชูุฑูุง ุฏุฑ ุงู ูุงู ุงุณุช.

---

## โ ุชุณุช ู ุงุนุชุจุงุฑุณูุฌ
- ุชุณุช Use Caseูุง ุจุงุฏ Invariantูุง Aggregate ุฑุง ูพูุดุด ุฏููุฏ ู ุฑุฎุฏุงุฏ ุฑูุฏุงุฏูุง ุฏุงููู ุฑุง ุจุฑุฑุณ ฺฉููุฏ.
- ุชุณุช ValueObjectูุง ุดุงูู ุจุฑุงุจุฑุ ุนุฏูโุชุบุฑูพุฐุฑ ู ุณุงุฒฺฏุงุฑ ุณุงุฒูุฏู ุงุณุช.
- ุชุณุช Repository ุจุงุฏ ุฑูุชุงุฑ ููโุฒูุงู ุฎูุดโุจูุงูู ู ูุฑุฒ ุชุฑุงฺฉูุด ุฑุง ุงุนุชุจุงุฑุณูุฌ ฺฉูุฏ.
- ุถุฏุงูฺฏู ุชุณุช: ุชุณุช ุฌุฏุงูู/ORM ุจูโุฌุง ุฑูุชุงุฑ ุฏุงููู.

---
